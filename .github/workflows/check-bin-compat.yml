name: Check bincompat

on:
  pull_request:
    {}

jobs:
  build:
    strategy:
      max-parallel: 100
      fail-fast: false
      matrix:
        hash:
          - 01edffd29a3afdd0931d0de765db3cab0dca41f6
          - 304b14b64e8214c282e0d07d5e403cca2b9be8ec
          - d850aa679d07786e59ecd337a0da5a5d23548cc6
          - bdd55e8c4d18dbac4c8830a2786df0829349cf29
          - e26ccf77c2bcccafbb7ab54730c7c39e1305e1cf
          - 666483f88a1107bde4bc87da629a09de76b4d528
          - f81a69c798b76bb44e16045abddbd9c8922f5f64
          - 26504628e966038913dac5c07197e99becc00f46
          - 5e159824366d47cc797c3298282d3d2e9f8f2100
          - 6e0f23803de024e0b0911c7e54155719cda3277f
          - 2039e546f8b8b9a4674ebdd7cf67606824c27a5f
          - eecc74fa1ba8e477e6fbd991b5b9bbb87b8f3918
          - c456cda6b5b9f61e1130ac2eefd135376146aaa3
          - 275237e7f4a32b51e5a0a06aa3f53a2d34a36596
          - af8195056a75dc6e8bcef75d02df7ef69a241c91
          - 5764538e37a6cce892d2f1b6144d2acae8883057
          - dd542bf9be97fff6c92925a25f35f86d4a83a56d
          - e319ca1238c7ba0066dd16d9c9a47d5de14744a2
          - 9a7fd6ed8dab2b012055d6e9eafd10ffb8a9f49d
          - 1d2556fe8afaf0558677ed2dd5636d0fe271a879
          - 2460f355488e997eb35938f7bd38351b889501ff
          - fb01fc34cc0a73d9036cb2951179c1f33f013191
          - 16545a6954960e39c186a9ad146235cee4e4bb48
          - 839dfc125b16f0aa2933978ba31dcc7114797426
          - af60b3879debf2ded7c7b4b927e9aaa63954c659
          - 93ccca0881a831389ecb7aff2892b8a482519eef
          - b8746ed1a263bf73021ff06099fb7a0e939d631b
          - a966604fe93fcfab6a0c664639e9a15238d0058d
          - 29ff5779b6e6f7dafd88c4020ce5366624174879
          - 8f61675745423c466699cbf20a9620d1e03db6c2
          - efce62c13f62054ed236cd629dd23385e15bd43e
          - 57d718b98331e113e7b579e991dd5de603d2c0a0
          - 99f1ededa011948c156cb40197ca2142cb809d20
          - 584a8115ff8e7219e98ea70f4204586af5d85486
          - 318843a1b81817d800ba14c9c749b6f2045b340c
          - 7944c7407093f3f5e767634f77575f629615f3b2
          - 8f3d5bbc7e1622fed22b4b119060fc905e3d7be3
          - 935eba29b462a245afdcc0f20439a7458b8fc38a
          - 969e893d70f42066ebb9f03d9f36b775512e925c
          - 12295d4e620e2febba3c147fadeb55d0cf6f2194
          - 93c12ea2078c07e00696980abcb8e3f7d9ab865b
          - 661594107a9eeee986ca66a1da04a57f4d48e6b1
          - 6d4b9da4f8994e38ea272ab18679a9941bd30d56
          - 264c34c49f09579a97682543a8d82f6a08ba67c6
          - bac11b666e469d24b3d29995402ceb8ab845a53e
          - dfe3e4b32c481d0d4c0299b3a514fea435817260
          - 5a1bd2460649328f5cc16ef06cbefd4ba551d0aa
          - 228786df20496a76640f791d06c56906adcd4ece
          - b49fe1a32886f8c18ebb87353b7df73fe394afbc
          - 6e20f96bba0d84e9bb755b489b0bd73d422ca039
          - dfb3aa59af4280381ffe5e5e2108c74358fead2c
          - b402f60d7bef3263b6c27e900203da42d35908fd
          - 5c3613f9037d7e94df26d587e079d22ad3c58d7b
          - 43ff5884247f3ea6ae89c6a1f33e8f8c62df6a40
          - 9463c4647fc8a04cc66bbcca6a86be748a952854
          - b0a43942ae2e7a2ebb6fbf048da20fb3e0a1178d
          - 75da01cc9fe5b9ba56d025264713f26b122be06a
          - 52936cae22b19b6e4b522dd4db97b20d8d1859aa
          - caf296bb827f69b70c78c2a46223dee9d6e50bac
          - c1d47818ef654331b9b0c7469491b733ca4f4d3a
          - 838139274d13093880d6ea124392bd8c79884c4b
          - c2df69b73967e884943cbf97f20db671a570448a
          - 6f972e482cc961a6d41adb22c8fc873788a46a7d
          - 322a6b1885da111cf4eafe58d3d569461ec13216
          - 684735948ae64df17de62e3627c9f4705c6e1b2d
          - 6af837d456d74caaba99f30e15e32665e1812c7a
          - b8065a407101b9f7706e17e9d92543f3d5e8fbdb
          - 28094bf669656cbe8578387827a0b145a43de192
          - 17854054b420475a36a16f3a07b1f388b80f38f2
          - 3408f62bc9233f337f9abd2380ee8634bdac83be
          - 6352d77122a1c82808c6b2241bd4bbcd08a37597

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        ref: ${{ matrix.hash }}

    - run: git log -1

    - name: Setup Java and Scala
      uses: olafurpg/setup-scala@v10
      with:
        java-version: 1.8.0

    - run: sbt +slick/compile

    - name: Check 2.12
      run: |
        sbt -Dsbt.launcher.coursier=false \
          'project slick' \
          'set mimaPreviousArtifacts := Set("3.3.0", "3.3.1", "3.3.2", "3.3.3").map { v: String =>
            "com.typesafe.slick" % ("slick_2.12") % v
           }' \
          'set mimaCheckDirection := "both"' \
          '++2.12.13 slick/mimaReportBinaryIssues'

    - name: Check 2.13
      run: |
        sbt \
          'project slick' \
          'set mimaPreviousArtifacts := Set("3.3.1", "3.3.2", "3.3.3").map { v: String =>
            "com.typesafe.slick" % ("slick_2.13") % v
           }' \
          'set mimaCheckDirection := "both"' \
          '++2.13.5 slick/mimaReportBinaryIssues'
